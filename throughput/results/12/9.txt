BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%sandy%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271783723.526104
 ALGERIA                   |   1997 | 453242155.320313
 ALGERIA                   |   1996 | 457134256.683583
 ALGERIA                   |   1995 | 465270116.813447
 ALGERIA                   |   1994 | 452022545.928187
 ALGERIA                   |   1993 | 461766309.293235
 ALGERIA                   |   1992 | 460404390.024413
 ARGENTINA                 |   1998 | 270942539.217348
 ARGENTINA                 |   1997 | 466679433.421471
 ARGENTINA                 |   1996 | 463782881.297552
 ARGENTINA                 |   1995 | 462246822.729018
 ARGENTINA                 |   1994 | 468322672.783762
 ARGENTINA                 |   1993 | 464862627.946217
 ARGENTINA                 |   1992 | 465579215.808624
 BRAZIL                    |   1998 | 275923537.453212
 BRAZIL                    |   1997 | 473565483.745744
 BRAZIL                    |   1996 | 462741630.563975
 BRAZIL                    |   1995 | 464960415.364461
 BRAZIL                    |   1994 | 468469865.386432
 BRAZIL                    |   1993 | 468714940.649722
 BRAZIL                    |   1992 | 471902788.275946
 CANADA                    |   1998 | 278506557.887047
 CANADA                    |   1997 | 483685000.303131
 CANADA                    |   1996 | 479565676.802162
 CANADA                    |   1995 | 487096802.089084
 CANADA                    |   1994 |  490510988.10461
 CANADA                    |   1993 | 480594314.016897
 CANADA                    |   1992 | 480658255.237857
 CHINA                     |   1998 | 274808100.841123
 CHINA                     |   1997 | 463623992.888751
 CHINA                     |   1996 | 461680835.849723
 CHINA                     |   1995 | 468848612.714693
 CHINA                     |   1994 | 466151382.954055
 CHINA                     |   1993 |  465920967.96473
 CHINA                     |   1992 | 466297004.688193
 EGYPT                     |   1998 | 270225547.967903
 EGYPT                     |   1997 | 461991478.440826
 EGYPT                     |   1996 | 465480315.748701
 EGYPT                     |   1995 | 471883364.653666
 EGYPT                     |   1994 | 463158407.233483
 EGYPT                     |   1993 | 470101113.691567
 EGYPT                     |   1992 | 471570853.445283
 ETHIOPIA                  |   1998 |  266647786.83934
 ETHIOPIA                  |   1997 | 457481259.244642
 ETHIOPIA                  |   1996 |  455606747.62986
 ETHIOPIA                  |   1995 |   457285536.5399
 ETHIOPIA                  |   1994 | 457752940.108801
 ETHIOPIA                  |   1993 | 456792185.335116
 ETHIOPIA                  |   1992 | 470821232.634155
 FRANCE                    |   1998 | 275584658.093586
 FRANCE                    |   1997 | 465914779.725979
 FRANCE                    |   1996 | 466635113.521368
 FRANCE                    |   1995 | 474160312.632818
 FRANCE                    |   1994 | 463445398.141838
 FRANCE                    |   1993 | 461264797.112638
 FRANCE                    |   1992 | 460944077.765008
 GERMANY                   |   1998 | 275171762.646684
 GERMANY                   |   1997 | 480887155.983955
 GERMANY                   |   1996 | 478585399.014668
 GERMANY                   |   1995 | 472943055.007163
 GERMANY                   |   1994 | 471999211.875698
 GERMANY                   |   1993 | 480253968.440067
 GERMANY                   |   1992 | 475527542.825158
 INDIA                     |   1998 | 284872327.474173
 INDIA                     |   1997 | 479253983.970973
 INDIA                     |   1996 | 473291022.382847
 INDIA                     |   1995 | 474821759.933579
 INDIA                     |   1994 | 480395123.470925
 INDIA                     |   1993 | 477851768.210704
 INDIA                     |   1992 | 475786729.978571
 INDONESIA                 |   1998 | 267888715.197093
 INDONESIA                 |   1997 | 455939517.405573
 INDONESIA                 |   1996 | 459363949.674825
 INDONESIA                 |   1995 | 450091914.101329
 INDONESIA                 |   1994 | 459248731.801697
 INDONESIA                 |   1993 | 451130330.019989
 INDONESIA                 |   1992 | 453733590.002512
 IRAN                      |   1998 | 270992890.815185
 IRAN                      |   1997 | 468720346.010799
 IRAN                      |   1996 | 472117198.066906
 IRAN                      |   1995 | 464583610.757091
 IRAN                      |   1994 | 473080632.275306
 IRAN                      |   1993 | 466660310.206735
 IRAN                      |   1992 | 467566999.428037
 IRAQ                      |   1998 | 276009589.831515
 IRAQ                      |   1997 | 472719983.833793
 IRAQ                      |   1996 | 473301684.941294
 IRAQ                      |   1995 | 479778701.606913
 IRAQ                      |   1994 | 473072495.191509
 IRAQ                      |   1993 | 471992435.345243
 IRAQ                      |   1992 | 474627154.682527
 JAPAN                     |   1998 | 271879912.237088
 JAPAN                     |   1997 | 464269404.729733
 JAPAN                     |   1996 | 464490944.039741
 JAPAN                     |   1995 | 469824899.808187
 JAPAN                     |   1994 | 466135384.266862
 JAPAN                     |   1993 | 463931848.140974
 JAPAN                     |   1992 | 470262879.170429
 JORDAN                    |   1998 | 264334893.979448
 JORDAN                    |   1997 | 453595406.266133
 JORDAN                    |   1996 | 456913409.955948
 JORDAN                    |   1995 | 454083615.748455
 JORDAN                    |   1994 |  459327495.16079
 JORDAN                    |   1993 | 465262638.173554
 JORDAN                    |   1992 | 460721854.377573
 KENYA                     |   1998 | 273278080.429181
 KENYA                     |   1997 | 468764769.377346
 KENYA                     |   1996 | 469895385.379915
 KENYA                     |   1995 | 469472787.923744
 KENYA                     |   1994 | 471137296.173846
 KENYA                     |   1993 | 467879178.055066
 KENYA                     |   1992 | 468481663.972413
 MOROCCO                   |   1998 | 277805322.672773
 MOROCCO                   |   1997 | 473505845.744403
 MOROCCO                   |   1996 | 469576757.717978
 MOROCCO                   |   1995 | 472630955.120962
 MOROCCO                   |   1994 |   474280430.2551
 MOROCCO                   |   1993 | 468385214.006928
 MOROCCO                   |   1992 | 461930209.347655
 MOZAMBIQUE                |   1998 | 272941642.687026
 MOZAMBIQUE                |   1997 |  452306781.06608
 MOZAMBIQUE                |   1996 | 452320798.375491
 MOZAMBIQUE                |   1995 | 454780669.987408
 MOZAMBIQUE                |   1994 | 458980438.665843
 MOZAMBIQUE                |   1993 | 450911801.804991
 MOZAMBIQUE                |   1992 | 452938200.144958
 PERU                      |   1998 | 266729193.623844
 PERU                      |   1997 | 455438253.085609
 PERU                      |   1996 | 461880180.794994
 PERU                      |   1995 | 463292171.508579
 PERU                      |   1994 | 470905256.039263
 PERU                      |   1993 | 457905973.563108
 PERU                      |   1992 | 466770801.657969
 ROMANIA                   |   1998 | 271822777.580624
 ROMANIA                   |   1997 | 460976702.607272
 ROMANIA                   |   1996 | 462240242.140834
 ROMANIA                   |   1995 | 462626822.767015
 ROMANIA                   |   1994 | 458234028.176007
 ROMANIA                   |   1993 | 456173572.626514
 ROMANIA                   |   1992 | 471592072.515006
 RUSSIA                    |   1998 | 271007166.647256
 RUSSIA                    |   1997 | 468661464.806865
 RUSSIA                    |   1996 | 489276073.026841
 RUSSIA                    |   1995 | 474393439.867739
 RUSSIA                    |   1994 |   478644583.1434
 RUSSIA                    |   1993 | 474375914.095595
 RUSSIA                    |   1992 | 479264089.943841
 SAUDI ARABIA              |   1998 | 274976038.051815
 SAUDI ARABIA              |   1997 | 471915728.953156
 SAUDI ARABIA              |   1996 | 469481776.083393
 SAUDI ARABIA              |   1995 | 468927174.934247
 SAUDI ARABIA              |   1994 |   464538723.9278
 SAUDI ARABIA              |   1993 | 468225908.155981
 SAUDI ARABIA              |   1992 | 472386914.915268
 UNITED KINGDOM            |   1998 | 275092376.480485
 UNITED KINGDOM            |   1997 | 471880303.232192
 UNITED KINGDOM            |   1996 | 474035297.490575
 UNITED KINGDOM            |   1995 | 464587152.277714
 UNITED KINGDOM            |   1994 | 470669859.006536
 UNITED KINGDOM            |   1993 | 469066351.197403
 UNITED KINGDOM            |   1992 | 471000229.330209
 UNITED STATES             |   1998 | 276817999.428165
 UNITED STATES             |   1997 | 473220461.959629
 UNITED STATES             |   1996 | 479455725.338124
 UNITED STATES             |   1995 | 473984377.992395
 UNITED STATES             |   1994 |  478018308.27456
 UNITED STATES             |   1993 | 479908024.441746
 UNITED STATES             |   1992 | 472147040.513584
 VIETNAM                   |   1998 | 269922749.841014
 VIETNAM                   |   1997 | 455349072.149881
 VIETNAM                   |   1996 | 464993816.545918
 VIETNAM                   |   1995 | 458425731.385197
 VIETNAM                   |   1994 | 457068366.841839
 VIETNAM                   |   1993 | 462314149.933737
 VIETNAM                   |   1992 | 459120613.065292
(175 rows)

COMMIT;
COMMIT
