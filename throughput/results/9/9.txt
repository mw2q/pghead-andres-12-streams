BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%antique%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 266489511.876674
 ALGERIA                   |   1997 | 447867371.790651
 ALGERIA                   |   1996 | 453113940.210817
 ALGERIA                   |   1995 | 457183584.597952
 ALGERIA                   |   1994 | 445308846.048727
 ALGERIA                   |   1993 | 452656173.057844
 ALGERIA                   |   1992 | 450998060.260947
 ARGENTINA                 |   1998 | 279602322.688552
 ARGENTINA                 |   1997 | 473112352.917905
 ARGENTINA                 |   1996 | 469534224.209446
 ARGENTINA                 |   1995 | 474619037.958194
 ARGENTINA                 |   1994 | 471570676.434625
 ARGENTINA                 |   1993 | 468146049.681612
 ARGENTINA                 |   1992 | 472968746.842445
 BRAZIL                    |   1998 | 270781777.103453
 BRAZIL                    |   1997 | 464714541.807327
 BRAZIL                    |   1996 | 459203303.671551
 BRAZIL                    |   1995 | 464876531.149105
 BRAZIL                    |   1994 |  461182765.94428
 BRAZIL                    |   1993 | 460712865.120059
 BRAZIL                    |   1992 | 459901938.639348
 CANADA                    |   1998 | 277525930.666046
 CANADA                    |   1997 | 474274878.727521
 CANADA                    |   1996 | 469684381.355426
 CANADA                    |   1995 | 468557343.313341
 CANADA                    |   1994 | 480548907.104283
 CANADA                    |   1993 | 479582361.546131
 CANADA                    |   1992 |  465341194.95958
 CHINA                     |   1998 | 269138834.566241
 CHINA                     |   1997 | 456839290.816686
 CHINA                     |   1996 | 461227241.665263
 CHINA                     |   1995 | 458845195.753665
 CHINA                     |   1994 | 456754653.653016
 CHINA                     |   1993 | 469944820.625263
 CHINA                     |   1992 | 459132691.453885
 EGYPT                     |   1998 | 275380890.046582
 EGYPT                     |   1997 | 469612341.129138
 EGYPT                     |   1996 | 472462174.150979
 EGYPT                     |   1995 | 470530185.763515
 EGYPT                     |   1994 | 468967887.686105
 EGYPT                     |   1993 | 468797983.508163
 EGYPT                     |   1992 | 460068309.525246
 ETHIOPIA                  |   1998 |  265211926.60567
 ETHIOPIA                  |   1997 | 455602260.118297
 ETHIOPIA                  |   1996 | 460031662.605392
 ETHIOPIA                  |   1995 | 457601260.022878
 ETHIOPIA                  |   1994 | 465293245.549025
 ETHIOPIA                  |   1993 | 461811326.839605
 ETHIOPIA                  |   1992 | 456826613.761414
 FRANCE                    |   1998 | 267463907.487211
 FRANCE                    |   1997 | 456834887.703866
 FRANCE                    |   1996 | 456122036.669188
 FRANCE                    |   1995 |  454525012.45993
 FRANCE                    |   1994 | 453921612.062917
 FRANCE                    |   1993 | 453557542.089628
 FRANCE                    |   1992 | 456253120.762479
 GERMANY                   |   1998 | 284899896.634982
 GERMANY                   |   1997 | 473320268.024611
 GERMANY                   |   1996 | 474225486.923448
 GERMANY                   |   1995 | 482290681.035423
 GERMANY                   |   1994 | 471204776.521381
 GERMANY                   |   1993 | 470245954.562619
 GERMANY                   |   1992 | 469604173.091297
 INDIA                     |   1998 | 272293371.127771
 INDIA                     |   1997 | 467054485.214811
 INDIA                     |   1996 | 481378488.987446
 INDIA                     |   1995 | 472636493.642654
 INDIA                     |   1994 | 472471838.355397
 INDIA                     |   1993 | 470002377.587468
 INDIA                     |   1992 | 471512872.519014
 INDONESIA                 |   1998 | 272931883.653614
 INDONESIA                 |   1997 | 463821988.997023
 INDONESIA                 |   1996 | 463682087.446111
 INDONESIA                 |   1995 | 462792403.393396
 INDONESIA                 |   1994 | 469435670.892634
 INDONESIA                 |   1993 | 464339115.416942
 INDONESIA                 |   1992 | 469196271.244838
 IRAN                      |   1998 | 275603177.537897
 IRAN                      |   1997 | 464393679.673777
 IRAN                      |   1996 | 476571657.051533
 IRAN                      |   1995 | 456873158.072319
 IRAN                      |   1994 | 463943883.337569
 IRAN                      |   1993 | 469803653.888181
 IRAN                      |   1992 | 471527288.369218
 IRAQ                      |   1998 | 266895229.321994
 IRAQ                      |   1997 | 456759782.259704
 IRAQ                      |   1996 | 464469341.045552
 IRAQ                      |   1995 | 452415722.538306
 IRAQ                      |   1994 |  455101789.67953
 IRAQ                      |   1993 | 457520829.845912
 IRAQ                      |   1992 | 455666102.444975
 JAPAN                     |   1998 | 272249580.389913
 JAPAN                     |   1997 | 465398392.965757
 JAPAN                     |   1996 | 462297989.490998
 JAPAN                     |   1995 | 469122199.459806
 JAPAN                     |   1994 | 464717563.349968
 JAPAN                     |   1993 | 465170335.670971
 JAPAN                     |   1992 | 460124759.487268
 JORDAN                    |   1998 | 262871144.450111
 JORDAN                    |   1997 | 451617483.142569
 JORDAN                    |   1996 | 449380054.556397
 JORDAN                    |   1995 | 454704225.751136
 JORDAN                    |   1994 | 448767368.292705
 JORDAN                    |   1993 |  454468516.62937
 JORDAN                    |   1992 | 447857607.465848
 KENYA                     |   1998 | 275718000.168403
 KENYA                     |   1997 | 475004208.510056
 KENYA                     |   1996 | 479684634.319104
 KENYA                     |   1995 |  466271841.63025
 KENYA                     |   1994 | 478388094.017627
 KENYA                     |   1993 | 470464623.039483
 KENYA                     |   1992 | 476165260.969774
 MOROCCO                   |   1998 | 269642926.260509
 MOROCCO                   |   1997 | 472162568.658899
 MOROCCO                   |   1996 | 469224500.092842
 MOROCCO                   |   1995 | 464156975.127662
 MOROCCO                   |   1994 | 464749696.774783
 MOROCCO                   |   1993 | 464584288.115902
 MOROCCO                   |   1992 | 473833935.935735
 MOZAMBIQUE                |   1998 | 268008627.098887
 MOZAMBIQUE                |   1997 | 459408597.601756
 MOZAMBIQUE                |   1996 | 458691102.037545
 MOZAMBIQUE                |   1995 | 458620651.743791
 MOZAMBIQUE                |   1994 | 452649399.639783
 MOZAMBIQUE                |   1993 | 457437660.213078
 MOZAMBIQUE                |   1992 | 457540272.489979
 PERU                      |   1998 | 269219516.833103
 PERU                      |   1997 | 451444460.701018
 PERU                      |   1996 | 456509693.800231
 PERU                      |   1995 | 454124971.033484
 PERU                      |   1994 | 451669514.394419
 PERU                      |   1993 |  454641919.03681
 PERU                      |   1992 | 460663039.728702
 ROMANIA                   |   1998 | 271561959.285705
 ROMANIA                   |   1997 | 470003103.689742
 ROMANIA                   |   1996 | 466804045.190838
 ROMANIA                   |   1995 | 467205071.835988
 ROMANIA                   |   1994 | 463354549.278142
 ROMANIA                   |   1993 | 463195445.351341
 ROMANIA                   |   1992 | 459834065.700057
 RUSSIA                    |   1998 | 272684616.398045
 RUSSIA                    |   1997 | 468148168.335338
 RUSSIA                    |   1996 | 474816258.735351
 RUSSIA                    |   1995 | 465745593.251788
 RUSSIA                    |   1994 | 462563043.640158
 RUSSIA                    |   1993 | 466939450.882168
 RUSSIA                    |   1992 | 467779497.826133
 SAUDI ARABIA              |   1998 | 272804418.325083
 SAUDI ARABIA              |   1997 | 464730718.064879
 SAUDI ARABIA              |   1996 | 470969497.139349
 SAUDI ARABIA              |   1995 |  471539988.59642
 SAUDI ARABIA              |   1994 | 470875767.648786
 SAUDI ARABIA              |   1993 | 467613426.796175
 SAUDI ARABIA              |   1992 | 471040885.686357
 UNITED KINGDOM            |   1998 | 274660244.755788
 UNITED KINGDOM            |   1997 | 461248452.942131
 UNITED KINGDOM            |   1996 | 459956461.926225
 UNITED KINGDOM            |   1995 | 459104241.875355
 UNITED KINGDOM            |   1994 | 453901796.436255
 UNITED KINGDOM            |   1993 |   463363425.4044
 UNITED KINGDOM            |   1992 | 461452855.509173
 UNITED STATES             |   1998 | 267311222.486898
 UNITED STATES             |   1997 | 461978658.386699
 UNITED STATES             |   1996 | 467652038.998168
 UNITED STATES             |   1995 | 471448361.137979
 UNITED STATES             |   1994 | 469791991.539935
 UNITED STATES             |   1993 | 463831191.537464
 UNITED STATES             |   1992 | 457020379.879369
 VIETNAM                   |   1998 |  271233634.50948
 VIETNAM                   |   1997 | 463187153.216732
 VIETNAM                   |   1996 | 461217961.988378
 VIETNAM                   |   1995 | 461374608.889749
 VIETNAM                   |   1994 | 467806443.420134
 VIETNAM                   |   1993 | 466131156.070748
 VIETNAM                   |   1992 | 464848551.452817
(175 rows)

COMMIT;
COMMIT
